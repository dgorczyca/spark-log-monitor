import {
  KVClient
} from "./chunk-2T664JH7.js";
import "./chunk-DC5AMYBS.js";

// node_modules/@github/spark/dist/heartbeat-event-types-BmKuwNhb.js
var EventType = {
  SPARK_RUNTIME_ERROR: "sparkRuntimeError",
  SPARK_RUNTIME_PING: "sparkRuntimePing",
  SPARK_RUNTIME_LOADED: "sparkRuntimeLoaded",
  SPARK_VITE_WS_CONNECT: "sparkViteWsConnect",
  SPARK_VITE_WS_DISCONNECT: "sparkViteWsDisconnect",
  SPARK_VITE_ERROR: "sparkViteError",
  SPARK_VITE_AFTER_UPDATE: "sparkViteAfterUpdate",
  ROOT_ELEMENT_STATUS: "rootElementStatus"
};

// node_modules/@github/spark/dist/llm.js
var MODEL_FIXES = {
  "ai21-jamba-instruct": "ai21-labs/ai21-jamba-instruct",
  "cohere-command-r-plus": "cohere/cohere-command-r-plus",
  "cohere-command-r": "cohere/cohere-command-r",
  "gpt-4o-mini": "openai/gpt-4o-mini",
  "gpt-4o": "openai/gpt-4o",
  "meta-llama-3.1-405b-instruct": "meta/meta-llama-3.1-405b-instruct",
  "meta-llama-3.1-70b-instruct": "meta/meta-llama-3.1-70b-instruct",
  "meta-llama-3.1-8b-instruct": "meta/meta-llama-3.1-8b-instruct",
  "meta-llama-3-70b-instruct": "meta/meta-llama-3-70b-instruct",
  "meta-llama-3-8b-instruct": "meta/meta-llama-3-8b-instruct",
  "mistral-large-2407": "mistral-ai/mistral-large-2407",
  "mistral-large": "mistral-ai/mistral-large",
  "mistral-nemo": "mistral-ai/mistral-nemo",
  "mistral-small": "mistral-ai/mistral-small",
  "phi-3-medium-128K-instruct": "microsoft/phi-3-medium-128K-instruct",
  "phi-3-medium-4K-instruct": "microsoft/phi-3-medium-4K-instruct",
  "phi-3-mini-128K-instruct": "microsoft/phi-3-mini-128K-instruct",
  "phi-3-mini-4K-instruct": "microsoft/phi-3-mini-4K-instruct",
  "phi-3-small-128K-instruct": "microsoft/phi-3-small-128K-instruct",
  "phi-3-small-8K-instruct": "microsoft/phi-3-small-8K-instruct"
};
var fixModelName = (modelName) => {
  if (!modelName)
    return "openai/gpt-4o";
  return MODEL_FIXES[modelName] || modelName;
};
async function llm(prompt, modelName, jsonMode) {
  const tidiedModelName = fixModelName(modelName);
  const response_format = { type: jsonMode ? "json_object" : "text" };
  const body = {
    messages: [
      { role: "system", content: "You are a helpful assistant." },
      { role: "user", content: prompt }
    ],
    temperature: 1,
    top_p: 1,
    max_tokens: 1e3,
    model: tidiedModelName,
    response_format
  };
  const response = await fetch("/_spark/llm", {
    method: "POST",
    body: JSON.stringify(body),
    headers: {
      "Content-Type": `application/json`
    }
  });
  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`LLM request failed: ${response.status} ${response.statusText} - ${errorText}`);
  }
  const data = await response.json();
  const content = data.choices[0].message.content;
  return content;
}
function llmPrompt(strings, ...values) {
  return strings.reduce((result, str, i) => result + str + (values[i] || ""), "");
}

// node_modules/@github/spark/dist/spark.js
var cachedUser = null;
async function fetchUser() {
  try {
    if (cachedUser) {
      return cachedUser;
    }
    const response = await fetch("/_spark/user");
    cachedUser = await response.json();
    return cachedUser;
  } catch (error) {
    console.error("Failed to fetch user data:", error);
    return null;
  }
}
var _a, _b;
var payload = {
  url: (_a = window == null ? void 0 : window.location) == null ? void 0 : _a.href,
  load_ms: (_b = window == null ? void 0 : window.performance) == null ? void 0 : _b.now()
};
window.parent.postMessage({
  type: EventType.SPARK_RUNTIME_LOADED,
  payload
}, "*");
fetch("/_spark/loaded", {
  method: "POST",
  headers: {
    "Content-Type": `application/json`
  },
  body: JSON.stringify(payload)
});
var kv = {
  keys: async () => {
    const client = new KVClient();
    return client.getKeys();
  },
  get: async (key) => {
    const client = new KVClient();
    return client.getKey(key);
  },
  set: async (key, value) => {
    const client = new KVClient();
    return client.setKey(key, value);
  },
  delete: async (key) => {
    const client = new KVClient();
    return client.deleteKey(key);
  }
};
window.spark = {
  llmPrompt,
  llm,
  user: fetchUser,
  kv
};
//# sourceMappingURL=@github_spark_spark.js.map

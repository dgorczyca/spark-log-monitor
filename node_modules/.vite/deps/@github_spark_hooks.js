import {
  KVClient,
  KvEventType
} from "./chunk-2T664JH7.js";
import {
  require_react
} from "./chunk-RUPNRBO7.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/@github/spark/dist/index.js
var import_react = __toESM(require_react());
function useKV(key, initialValue) {
  const [value, setValue] = (0, import_react.useState)(initialValue);
  const kvClient = (0, import_react.useMemo)(() => {
    return new KVClient();
  }, []);
  const handleMessage = (0, import_react.useCallback)(async (event) => {
    switch (event.data.type) {
      case KvEventType.SPARK_KV_DELETED:
        if (event.data.payload.key === key) {
          setValue(void 0);
        }
        return;
      case KvEventType.SPARK_KV_UPDATED:
        if (event.data.payload.key === key) {
          setValue(await kvClient.getKey(key));
        }
        return;
    }
  }, [key]);
  (0, import_react.useEffect)(() => {
    if (!import.meta.env.DEV) {
      return;
    }
    window.addEventListener("message", handleMessage);
    return () => {
      window.removeEventListener("message", handleMessage);
    };
  }, [key, handleMessage]);
  (0, import_react.useEffect)(() => {
    async function getOrSetKey() {
      setValue(await kvClient.getOrSetKey(key, initialValue));
    }
    getOrSetKey();
  }, [kvClient]);
  const deleteValue = (0, import_react.useCallback)(() => {
    kvClient.deleteKey(key);
    setValue(void 0);
  }, [key]);
  const userSetValue = (0, import_react.useCallback)((newValue) => {
    setValue((currentValue) => {
      const nextValue = typeof newValue === "function" ? newValue(currentValue) : newValue;
      kvClient.setKey(key, nextValue);
      return nextValue;
    });
  }, [key, kvClient]);
  return [value, userSetValue, deleteValue];
}
export {
  useKV
};
//# sourceMappingURL=@github_spark_hooks.js.map
